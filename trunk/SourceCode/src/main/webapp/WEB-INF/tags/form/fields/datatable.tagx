<jsp:root xmlns:c="http://java.sun.com/jsp/jstl/core"
	xmlns:fn="http://java.sun.com/jsp/jstl/functions"
	xmlns:util="urn:jsptagdir:/WEB-INF/tags/util"
	xmlns:spring="http://www.springframework.org/tags"
	xmlns:form="http://www.springframework.org/tags/form"
	xmlns:fmt="http://java.sun.com/jsp/jstl/fmt"
	xmlns:jsp="http://java.sun.com/JSP/Page" version="2.0">
	<jsp:directive.tag import="java.util.ArrayList" />
	<jsp:output omit-xml-declaration="yes" />

	<jsp:directive.attribute name="thead" type="java.lang.String"
		required="false" rtexprvalue="true" description="The server source" />

	<jsp:directive.attribute name="path" type="java.lang.String"
		required="true" rtexprvalue="true" description="The path" />

	<jsp:directive.attribute name="aoColumns" type="java.lang.String"
		required="true" rtexprvalue="true" description="The aoColumns" />

	<jsp:directive.attribute name="id" type="java.lang.String"
		required="true" rtexprvalue="true" description="The id" />

	<spring:url value="/resources/media/js/jquery.dataTables.js"
		var="datatables_js" />
	<spring:url value="/resources/media/js/TableTools.js" var="table_tool" />
	<script type="text/javascript" language="javascript"
		src="${datatables_js }">
		
	</script>
	<script type="text/javascript" language="javascript"
		src="${table_tool }">
		
	</script>
	<spring:url value="/resources/scripts/dynatree/jquery-ui.custom.js"
		var="jquery_ui" />

	<script type="text/javascript" src="${jquery_ui }">
	<!-- aa -->		
	</script>
	<spring:url value="/resources/media/css/table_jui.css"
		var="demo_table_css" />
	<spring:url
		value="/resources/styles/workitem_content/jquery-ui-1.8.19.custom.css"
		var="workitem_content_css" />
	<spring:url value="${path}/" var="lDelete"/>
	<spring:url value="${path}/" var="lShow" />
	<spring:url value="${path}/mList" var="source" />
	<spring:url value="${path}?form" var="lNew" />
	<c:set var="ao" value='[ {"mDataProp" : null,"bSortable" : false}' />
	<c:forTokens items="${aoColumns}" var="column" delims="{,}">
		<c:set var="ao" value='${ao},{"mDataProp" :"${column}"}' />
	</c:forTokens>
	<c:set var="ao" value='${ao}]' />
	<style type="text/css" title="currentStyle">
@import "${demo_table_css}";

@import "${workitem_content_css}";
</style>

	

	<SCRIPT type="text/javascript">
	$(function() {
		//debugger;
		//isAddLinkHanlder = false;
		//isAddFormSubmitHandler = false;
		$('#table').on('click', '#tb_paginate a',
				function(event) {
					event.stopImmediatePropagation();
				})
		var tabContent = $('div:not(.ui-tabs-hide) > #main').parent();
		$(tabContent).off('click', 'a', linkClickHandler);
		$(tabContent).on('click', 'a', function(event) {
			var url = this.href;
			alert(url);
			if (url.indexOf('/ID/') != -1) {
				location.open(url);

			} else {
				$('#table').load(this.href, function() {

				}).change();
				event.preventDefault();

			}
		});
		addFormSubmitHandler('#table', '#table');
	});	
	
		$(document)
				.ready(
						function() {
							//debugger;
							
							$('#${id}').on('click', '#${id} tbody tr td',
									function(event) {									
										//var id =   $(this).parent().attr("id");
										//alert(id);
										//show(id);
									});
							
							oTable= $("#${id}")
									.dataTable(
											{
												"bProcessing" : true,
												"bServerSide" : true,
												"sAjaxSource" : "${source}",												
												"aoColumns" : ${ao},
												"bJQueryUI" : true,												
												"sPaginationType" : "full_numbers",
												"sDom" : '&lt;"H"&lt;"datatable_buttons"eeee&gt;fr&gt;t&lt;"F"lip&gt;',												
												"fnCreatedRow" : function(nRow,
														aData, iDataIndex) {
													if (iDataIndex == 0) {
														$(
																"#${id} thead tr td:first-child input[type=checkbox]")
																.attr(
																		'checked',
																		null);
													}
													$(nRow.firstChild)
															.html(
																	'<input type="checkbox"/>');
												}

											});		
							
							
	                         
						});
		 $(function() {
			$('.datatable_buttons')
					.html(
							'<button onclick="fnew()">New</button><button onclick="fshow()">Show</button><button onclick="fdel()">Delete</button>'); 
			
			
		}); 
		
		$(function() {
			var test = $('#${id} thead tr th:first-child');
			$('#${id} thead tr:first-child input[type=checkbox]')
					.on(
							'click',
							function() {
								var selected = null;
								if ($(this).attr('checked') != null) {
									selected = "selected";
								}
								$(
										'#${id} tbody tr td:first-child input[type=checkbox]')
										.attr('checked', selected);
							});
		});
		
	</SCRIPT>
	
	<script type="text/javascript">
		var oTable;
		function fnew(){
			//debugger;
			$(panel).load("${lNew}", function() {});
			
		}
		
		function fshow(){
			//debugger;
			var s = $('#${id} tbody tr td:first-child input:checked');
			var c = $('#${id} tbody tr td:first-child input:checked').length;
			
			if(c>0){
				var idtr = $(s.parent().parent()[0]).attr('id');
				var url="${lShow}"+idtr+"?form";
				//alert(url);
				//window.location=url;
				$(panel).load(url, function() {});
			}
		}
		
		function show(id){
			var url="${lShow}"+id;
			//alert(url);
			window.location=url;
		}
		function fdel(){
			var s = $('#${id} tbody tr td:first-child input:checked');
			var c = $('#${id} tbody tr td:first-child input:checked').length;
			
			if(c>0){
				
				var idtr = $(s.parent().parent()[0]).attr('id');
				$.ajax({
			        type: "DELETE",
			        url: "${lDelete}"+idtr,
			        success:function(){			        	
			        		$("#"+idtr).html("");
			        		alert("item is deleted !");
			        	} 
			    });
			}
			debugger;			
		}
	</script>
	<div id="table" class="table_content">
		<TABLE id="${id}" cellpadding="0" cellspacing="0" border="0"
			class="display disable-a-handler">

			<THEAD>
				<th><input type="checkbox" /></th>
				<c:forTokens items="${thead}" var="item" delims="{,}">
					<th>${item}</th>
				</c:forTokens>
			</THEAD>

			<TBODY>
				<tr>
					<td colspan="4">Loading...</td>
				</tr>
			</TBODY>
		</TABLE>
	</div>
</jsp:root>